# react-playground

## ドキュメントを読む

[避難ハッチ – React](https://ja.react.dev/learn/escape-hatches)

このページには、このセクションに含まれるページの概要が書かれている。

`useRef`は、コンポーネントに情報を持たせたいが、その情報を更新したときに再レンダリングが行われないようにしたい場合に使う。

`ref`の値は`ref.current`で参照できる。JSXの中に埋め込むこともできる。この場合は、再レンダリングが発生したときに、最新の値が表示される。

↑`ref`が状態を保持するために作られているというよりは、そのように使うこともできる、みたいな感じかな？

## useEffectについて

データの変換（派生データの計算）に`useEffect`を使う必要はない。再レンダリングの時に、コンポーネント内の処理が実行されるので、そこで計算すればよい。

`useEffect`が行うのは、同期の開始と終了。よく分かってない。同期の終了の処理あんまり書いたことなかった。

## イベントとエフェクトを切り離す

イベントとエフェクトを切り離す、これ知らなかった重要なことが書かれていそう。多分、最近かいたぐちゃぐちゃのコードはこれを使えば綺麗に書けそう。`useEffect`の中で使いたいけれど、別にその値が変更された時に再度実行したい訳ではないんだよね...みたいなことがあった。

`ChatRoom`コンポーネントは、`roomId`と`theme`を受け取り、ルームへの接続を行う。ルームへ接続したときに、通知を表示し、この通知は`theme`に基づいて色が変わる。

useEffectで、`roomId`と`theme`を依存配列に指定して、ルームへの接続処理と通知処理を書いている。しかし、このままだとルームを変更しただけではなく、テーマを変えたときに再度接続してしまう。

これを回避するためには`useEffectEvent`を使うといいらしい。普通にコールバックを書くだけだったら、`theme`が変わったときもエフェクトが実行されるようになってしまうのだと思う。このあたりの仕様（実装、仕組み）がどうなってるか気になる。

## エフェクトから依存値を取り除く

useEffectの依存配列には、エフェクトで仕様している全てのリアクティブな値を指定するべき。なぜかというと、Effectはコンポーネントの最新の状態と同期するために使うものだから。チャットの例で言えば、ルームIDと、コネクションを同期させている。

🐤 そもそも、useEffectがどういう目的で作られたAPIなのか、一般的なUI開発ではどういう概念にあたるのかを理解するのが良さそう。

リアクティブな値というのは、`state`や`props`だけではなく、コンポーネントで計算している値のことも含まれていそう。`options`の例。

「依存値のリストは、あなたにコードを説明している」この考え方重要だなと思った。ドキュメントに書かれていることとは違うけれど、次のように考えるといいと思う。

まずサーバーに接続するエフェクトは、ルームが変更された場合にのみ実行するべきだ。つまり、エフェクトの依存配列には`roomId`しか指定できない。なので、他の値が必要な場合は、エフェクト内で計算したり、エフェクトイベント内で参照する必要がある。

## メモ

まとめページのエフェクトについての部分は読んだので、次は個別のページを読んでいきましょう。
